<odoo>
    <data>

        <!-- adding verification button -->
        <record id="survey_view_form_inherit" model="ir.ui.view">
            <field name="name">survey.survey.form.inherit.custom</field>
            <field name="model">survey.survey</field>
            <field name="inherit_id" ref="survey.survey_survey_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='user_id']" position="replace">
                    <field name="user_id" string="Anaesthetist" domain="[('share', '=', False)]" widget="many2one_avatar_user" readonly="state != 'draft'"/>
                    <field name="template_type" invisible="survey_type != 'custom'" readonly="state != 'draft'"/>
                    <field name="is_surgery_ques_enabled" readonly="state != 'draft'" invisible="type_of_survey != 'medical_history'"/>
                    <field name="is_medic_ques_enabled" readonly="state != 'draft'" invisible="type_of_survey != 'medical_history'"/>
                </xpath>
                <xpath expr="//header" position="inside">
                    <field name="state" widget="statusbar"/>
                </xpath>
                <xpath expr="//button[@name='action_send_survey']" position="before">
                    <button name="finalise" string="Finalise" type="object" invisible="state != 'draft'" class="oe_highlight" />
                </xpath>
                <xpath expr="//button[@name='action_archive']" position="before">
                    <button name="reset_to_draft" string="Reset to Draft" groups="p7_patient_management.group_user_admin" type="object" invisible="state == 'draft' or template_type != 'reference'" />
                    <button name="reset_to_draft" string="Reset to Draft" type="object" invisible="state == 'draft' or template_type == 'reference'" />
                </xpath>
                <xpath expr="//field[@name='survey_type']" position="replace">
                    <field name="survey_type" widget="radio" invisible="1" options="{'horizontal': True}"/>
                    <field name="type_of_survey" widget="radio" options="{'horizontal': True}" readonly="state != 'draft'" invisible="survey_type != 'custom'"/>
                </xpath>
                <xpath expr="//field[@name='title']" position="replace">
                    <field name="title" readonly="state != 'draft'" options="{'line_breaks': False}" widget="text" placeholder="e.g. Satisfaction Survey"/>
                </xpath>
                <xpath expr="//form/sheet/group/group" position="after">
                    <group>
                        <field name="version" readonly="state != 'draft'"/>
                        <field name="note" readonly="state != 'draft'"/>
                        <field name="is_super_admin" invisible="1"/>
                        <field name="is_height_ques_enabled" readonly="state != 'draft'" invisible="type_of_survey != 'medical_history'"/>
                        <field name="is_weight_ques_enabled" readonly="state != 'draft'" invisible="type_of_survey != 'medical_history'"/>
                    </group>
                </xpath>
                <xpath expr="//page[@name='questions']" position="replace">
                    <page string="Questions" name="questions" invisible="not is_super_admin">
                        <field name="question_and_page_ids" nolabel="1" widget="question_page_one2many" mode="tree,kanban" context="{'default_survey_id': id}">
                            <tree decoration-bf="is_page">
                                <field name="sequence" widget="handle"/>
                                <field name="title" widget="survey_description_page"/>
                                <field name="background_image" column_invisible="True"/>
                                <field name="question_type" />
                                <field name="constr_mandatory" optional="1"/>
                                <field name="is_page" column_invisible="True"/>
                                <field name="is_duplicated" column_invisible="True"/>
                                <field name="questions_selection" column_invisible="True"/>
                                <field name="survey_id" column_invisible="True"/>
                                <field name="random_questions_count"
                                    column_invisible="parent.questions_selection == 'all'"
                                    invisible="not is_page"/>
                                <field name="triggering_question_ids" column_invisible="True"/>
                                <field name="triggering_answer_ids" column_invisible="True" widget="many2many_tags"/> 
                                <widget name="survey_question_trigger" width="30px"/>
                                <button name="copy" type="object" icon="fa-clone" title="Duplicate Question"/>
                                <control>
                                    <create name="add_question_control" string="Add a question"/>
                                    <create name="add_section_control" string="Add a section" context="{'default_is_page': True, 'default_questions_selection': 'all'}"/>
                                </control>
                            </tree>
                        </field>
                    </page>
                    <page string="Detailed Questions" name="patient_history_questions">
                        <field name="patient_ques_and_page_ids" nolabel="1" widget="question_page_one2many"
                                readonly="state != 'draft'" 
                                mode="tree,kanban" 
                                context="{'default_survey_id': id, 'default_patient_survey_id': id, 'default_question_tag': 'normal',}"
                                >
                            <tree decoration-bf="is_page" limit="200">
                                <field name="sequence" widget="handle" column_invisible="parent.state != 'draft'"/>
                                <field name="title" widget="survey_description_page"/>
                                <field name="background_image" column_invisible="True"/>
                                <field name="question_type" />
                                <field name="constr_mandatory" optional="1"/>
                                <field name="is_page" column_invisible="True"/>
                                <field name="questions_selection" column_invisible="True"/>
                                <field name="survey_id" column_invisible="True"/>
                                <field name="question_tag" column_invisible="True"/>
                                <field name="random_questions_count"
                                    column_invisible="parent.questions_selection == 'all'"
                                    invisible="not is_page"/>
                                <field name="triggering_question_ids" column_invisible="True"/>
                                <field name="triggering_answer_ids" column_invisible="True" widget="many2many_tags"/>
                                <widget name="survey_question_trigger" width="30px"/>
                                <button name="copy" type="object" icon="fa-clone" title="Duplicate Question"/>
                                <control>
                                    <create name="add_question_control" string="Add a question"/>
                                    <create name="add_section_control" string="Add a section" context="{'default_is_page': True, 'default_questions_selection': 'all', 'default_question_tag': 'normal',}"/>
                                </control>
                            </tree>
                        </field>
                    </page>
                    <page string="Surgery History Questions" name="surgic_history_questions" invisible="1">
                        <field name="surgic_ques_and_page_ids" nolabel="1" widget="question_page_one2many" readonly="state != 'draft'" mode="tree,kanban" context="{'default_surgic_survey_id': id, 'default_question_tag': 'surgery',}">
                            <tree decoration-bf="is_page">
                                <field name="sequence" widget="handle"/>
                                <field name="title" widget="survey_description_page"/>
                                <field name="background_image" column_invisible="True"/>
                                <field name="question_type" />
                                <field name="constr_mandatory" optional="1"/>
                                <field name="is_page" column_invisible="True"/>
                                <field name="questions_selection" column_invisible="True"/>
                                <field name="survey_id" column_invisible="True"/>
                                <field name="question_tag" column_invisible="True"/>
                                <field name="random_questions_count"
                                    column_invisible="parent.questions_selection == 'all'"
                                    invisible="not is_page"/>
                                <field name="triggering_question_ids" column_invisible="True"/>
                                <field name="triggering_answer_ids" column_invisible="True" widget="many2many_tags"/>
                                <widget name="survey_question_trigger" width="30px"/>
                                <button name="copy" type="object" icon="fa-clone" title="Duplicate Question"/>
                                <control>
                                    <create name="add_question_control" string="Add a question"/>
                                    <create name="add_section_control" string="Add a section" context="{'default_is_page': True, 'default_questions_selection': 'all', 'default_question_tag': 'surgery',}"/>
                                </control>
                            </tree>
                        </field>
                    </page>
                    <page string="Medication History Questions" name="medic_history_questions" invisible="1">
                        <field name="medic_ques_and_page_ids" nolabel="1" widget="question_page_one2many" readonly="state != 'draft'" mode="tree,kanban" context="{'default_medic_survey_id': id, 'default_question_tag': 'medical',}">
                            <tree decoration-bf="is_page">
                                <field name="sequence" widget="handle"/>
                                <field name="title" widget="survey_description_page"/>
                                <field name="background_image" column_invisible="True"/>
                                <field name="question_type" />
                                <field name="constr_mandatory" optional="1"/>
                                <field name="is_page" column_invisible="True"/>
                                <field name="questions_selection" column_invisible="True"/>
                                <field name="survey_id" column_invisible="True"/>
                                <field name="question_tag" column_invisible="True"/>
                                <field name="random_questions_count"
                                    column_invisible="parent.questions_selection == 'all'"
                                    invisible="not is_page"/>
                                <field name="triggering_question_ids" column_invisible="True"/>
                                <field name="triggering_answer_ids" column_invisible="True" widget="many2many_tags"/>
                                <widget name="survey_question_trigger" width="30px"/>
                                <button name="copy" type="object" icon="fa-clone" title="Duplicate Question"/>
                                <control>
                                    <create name="add_question_control" string="Add a question"/>
                                    <create name="add_section_control" string="Add a section" context="{'default_is_page': True, 'default_questions_selection': 'all', 'default_question_tag': 'medical',}"/>
                                </control>
                            </tree>
                        </field>
                    </page>
                </xpath>
                <!-- <xpath expr="//field[@name='questions_layout']" position="after">
                    <group>
                        <field name="is_surgery_ques_enabled" readonly="state != 'draft'"/>
                        <field name="is_medic_ques_enabled" readonly="state != 'draft'"/>
                    </group>
                    <group>
                        <field name="surgery_ques" invisible="not is_surgery_ques_enabled"/>
                        <field name="medication_ques" invisible="not is_medic_ques_enabled"/>
                    </group>
                </xpath> -->
                <xpath expr="//field[@name='users_can_go_back']" position="replace">
                    <field name="users_can_go_back" string="Allow Roaming" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='question_and_page_ids']" position="attributes">
                    <attribute name="readonly">state != 'draft'</attribute>
                </xpath>
                <xpath expr="//field[@name='questions_layout']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='progression_mode']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='options']/group/group[@name='questions']/field[@name='questions_selection']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//group[@name='participants']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//group[@name='scoring']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='options']/group/group[4]" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='options']" position="attributes">
                    <attribute name="invisible">type_of_survey != 'medical_history'</attribute>
                </xpath>
                <xpath expr="//button[@name='action_send_survey']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='action_start_session']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='action_print_survey']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='action_archive']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='action_result_survey']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='action_test_survey']" position="attributes">
                    <attribute name="invisible">0</attribute>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='description']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='description_done']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='options']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
            </field>
        </record>

        <!-- adding repeatative question boolean -->
        <record id="survey_question_view_form_inherit" model="ir.ui.view">
            <field name="name">survey.question.form.inherit.custom</field>
            <field name="model">survey.question</field>
            <field name="inherit_id" ref="survey.survey_question_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='triggering_answer_ids']" position="after">
                    <!-- invisible="question_type != 'simple_choice'" -->
                    <field name="is_repeat_question" invisible="1" />
                    <field name="suffix" invisible="is_repeat_question != True"/>
                    <field name="medic_details" invisible="question_type != 'char_box'"/>
                </xpath>
                <xpath expr="//tree/field[@name='value_image']" position="attributes">
                    <attribute name="column_invisible">True</attribute>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[3]/group[2]/group[2]" position="attributes">
                    <attribute name="invisible">True</attribute>
                </xpath>
            </field>
        </record>

        <record id="view_survey_user_input_inherit" model="ir.ui.view">
            <field name="name">survey.user_input.inherit.highlight_duplicated</field>
            <field name="model">survey.user_input</field>
            <field name="inherit_id" ref="survey.survey_user_input_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//form/sheet/group" position="replace">
                    <group col="2">
                        <group>
                            <field name="deadline" invisible="1"/>
                            <field name="type_of_survey" invisible="1"/>
                            <field name="is_attempts_limited" invisible="1"/>
                            <field name="partner_id"/>
                            <field name="op_nric_number" readonly="1" invisible="type_of_survey == 'feedback'"/>
                            <field name="op_datetime" invisible="type_of_survey == 'feedback'"/>
                            <label for="op_duration_hrs" string="Duration" readonly="1" invisible="type_of_survey == 'feedback'"/>
                            <div class="d-flex flex-row justify-content-start" invisible="type_of_survey == 'feedback'">
                                <div class="d-flex" invisible="type_of_survey == 'feedback'">
                                    <field name="op_duration_hrs" required="1" readonly="1" nolabel="1" style="width:6%;"/>
                                    <span class="mx-3">Hrs </span>
                                </div>
                                <div class="d-flex" invisible="type_of_survey == 'feedback'">
                                    <field name="op_duration_mins" nolabel="1" readonly="1" style="width:6%;"/>
                                    <span class="mx-3">Mins</span>
                                </div>
                            </div>
                            <field name="location" readonly="1" invisible="type_of_survey == 'feedback'"/>
                            <field name="note" string="Notes"/>
                            <field name="case_guide_state" invisible="1"/>
                        </group>
                        <group>
                            <field name="scoring_type" invisible="1"/>
                            <field name="scoring_success" invisible="1"/>
                            <field name="age" invisible="type_of_survey == 'feedback'"/>
                            <field name="gender" readonly="1" invisible="type_of_survey == 'feedback'"/>
                            <field name="bmi" invisible="type_of_survey == 'feedback'"/>
                            <field name="op_process" invisible="type_of_survey == 'feedback'"/>
                            <field name="op_surgeon" invisible="type_of_survey == 'feedback'"/>
                        </group>
                    </group>
                </xpath>
                <xpath expr="//form/sheet/notebook/page" position="replace">
                    <page string="Answers" name="page_answers">
                        <field name="user_input_line_ids" mode="tree" no_label="1">
                            <tree decoration-muted="skipped == True" 
                                  decoration-primary="colour in ['#b3e0ff','#ffcccc','#ffcce6']" 
                                  decoration-warning="colour in ['#ffffb3','#ffe6cc','#d9ffb3']" 
                                  decoration-success="colour in ['#e6ffff','#cce0ff','#d9f2e6']" 
                                  decoration-danger="colour in ['#ffccff','#fff0b3','#ecc6c6']" editable="bottom" create="0">
                                <field name="question_sequence" column_invisible="True"/>
                                <field name="colour" column_invisible="True"/>
                                <field name="is_hidden" column_invisible="True"/>
                                <field name="create_date" optional="hidden"/>
                                <field name="page_id" optional="hidden"/>
                                <field name="question_id" readonly="1"/>
                                <field name="answer_type" optional="hidden"/>
                                <field name="skipped" hide="1" optional="hidden"/>
                                <field name="display_name" string="Answer" readonly="1" class="o_list_text"/>
                                <field name="note" string="Notes"/>
                                <field name="answer_is_correct" optional="hidden"/>
                                <field name="answer_score" sum="Score" optional="hidden"/>
                                <button name="action_download_file" invisible="answer_type != 'file'" string="" class="fa fa-download btn-primary" type="object" title="Download File"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//button[@name='action_resend']" position="replace">
                    <button name="action_resend" string="Resend Invitation" type="object" class="oe_highlight"
                        invisible="1"/>
                </xpath>
                <xpath expr="//button[@name='action_print_answers']" position="replace">
                    <!-- <button name="action_print_answers" invisible="state == 'new'" string="Print" type="object"  class="oe_highlight"/> -->
                    <button name="action_download_answers" invisible="state not in ('done','review')" string="Download" type="object" class="oe_highlight"/>
                    <button name="action_review_state_update" invisible="state != 'done'" string="Mark as Reviewed" class="oe_highlight" type="object"/>
                </xpath>
                <xpath expr="//form/sheet/notebook" position="after">
                    <group>
                        <separator string="Anaesthetic Plan Details" invisible="type_of_survey == 'feedback'"/>
                        <group invisible="type_of_survey == 'feedback'">
                            <label for="inform_guide_id"/>
                            <div class="d-flex">
                                <field name="inform_guide_id" readonly="state not in ('done','review') or case_guide_state == 'sent'" domain="[('state', '=', 'release'),('create_uid', '=', uid)]" options="{'no_open':True, 'no_create':True}" nolabel="1"/>
                                <button type="object" name="action_case_guide_update" class="btn btn-light mx-2" string="" invisible="not inform_guide_id or case_guide_state == 'sent'"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> </button>
                                <button type="object" name="action_case_guide_update" class="btn btn-light mx-2" string="" invisible="not inform_guide_id or case_guide_state != 'sent'"><i class="fa fa-arrow-right" aria-hidden="true"></i> </button>
                                <button name="action_update_guide" string="Convert to Teleconsult" type="object" invisible="not inform_guide_id or state not in ('done','review') or case_guide_state != 'draft'" class="oe_highlight" />
                                <button name="action_patient_guide" string="Send to Patient" type="object" invisible="not inform_guide_id or state not in ('done','review') or case_guide_state != 'update'" class="oe_highlight" />
                            </div>
                            <label for="additional_info_ids"/>
                            <div class="d-flex">
                                <field name="additional_info_ids" widget="many2many_tags" readonly="state not in ('done','review') or case_guide_state == 'sent'" domain="[('create_uid', '=', uid)]" options="{'no_open':True, 'no_create':True}" nolabel="1"/>
                            </div>
                            <label for="location_id"/>
                            <div class="d-flex">
                                <field name="location_id" domain="[('user_id','=',uid)]" readonly="state not in ('done','review') or case_guide_state == 'sent'" options="{'no_open':True, 'no_create':True}" nolabel="1"/>
                            </div>
                        </group>
                        <separator string="Video Call Documentation" invisible="case_tier != 'premium'"/>
                        <group invisible="case_tier != 'premium'" class="col-lg-12">
                            <group>
                                <field name="case_tier" invisible="1"/>
                                <label for="video_call_status" string="Video Call Status"/>
                                <field name="video_call_status" nolabel="1" required="0" readonly="1"/>
                                <label for="video_call_performed_by" string="Contact Attempt Performed By"
                                       class="required-label"/>
                                <field name="video_call_performed_by" nolabel="1" required="0"/>
                                <label for="bypass_reason" string="Bypass Reason" invisible="video_call_status != 'bypassed'"/>
                                <field name="bypass_reason" nolabel="1" readonly="1" widget="text"
                                       invisible="video_call_status != 'bypassed'"/>
                                <label for="video_call_datetime" string="Contact Attempt Date Time" class="required-label"/>
                                <field name="video_call_datetime" nolabel="1"/>
                                <label for="video_call_location" string="Patient Location" class="required-label"/>
                                <field name="video_call_location" nolabel="1" required="0"/>
                                <label for="contact_channel" string="Contact Channel" class="required-label"/>
                                <field name="contact_channel" nolabel="1" required="0"/>
                                <field name="video_call_contents" required="0" widget="text"/>
                                <label for="associate_id" string="Associate" class="required-label"/>
                                <field name="associate_id" nolabel="1" groups="p7_patient_management.group_user_admin" options="{'no_create':True}" readonly="video_call_assign_status == 'assigned'"/>
                                <field name="associate_id" nolabel="1" groups="p7_patient_management.group_user_doctor" options="{'no_open': True}" readonly="1"/>
                                <label for="video_call_outcome" string="Contact Attempt Outcome" invisible="video_call_outcome == False"/>
                                <field name="video_call_outcome" nolabel="1" required="0" readonly="1" invisible="video_call_outcome == False"/>
                                <label for="attempt_count" string="Attempts"
                                       groups="p7_patient_management.group_user_doctor,p7_patient_management.group_user_admin"/>
                                <field name="attempt_count" nolabel="1" readonly="1"
                                       groups="p7_patient_management.group_user_doctor,p7_patient_management.group_user_admin"/>
                            </group>

                            <!-- shown to admin/associate only -->
                            <group>
                                <div class="d-flex flex-column" style="gap:8px; width:200px;"><!-- ensures one per row -->
                                    <button name="action_assign_to_associate" type="object" string="Delegate to Associate"
                                            class="oe_highlight"
                                            groups="p7_patient_management.group_user_doctor,p7_patient_management.group_user_admin"
                                            invisible="video_call_assign_status != 'unassigned'"
                                            confirm="Assign contact attempt to associate?"/>

                                    <button name="action_video_call_success" type="object" string="Video Call Successful"
                                            class="oe_highlight"
                                            groups="p7_patient_management.group_user_doctor,p7_patient_management.group_user_admin"
                                            confirm="Mark video call successful?"/>

                                    <button name="action_video_call_fail" type="object" string="Video Call Fail"
                                            class="oe_highlight"
                                            groups="p7_patient_management.group_user_doctor,p7_patient_management.group_user_admin"
                                            confirm="Mark video call failed?"/>

                                    <button name="action_open_bypass_wizard" type="object" string="Bypass"
                                            class="oe_highlight"
                                            groups="p7_patient_management.group_user_doctor,p7_patient_management.group_user_admin"
                                            invisible="video_call_status == 'bypassed'"/>
                                </div>
                            </group>
                            <field name="video_call_assign_status" invisible="1"/>
                        </group>
                        <separator string="Answer Details"/>
                        <group>
                            <field name="survey_id"/>
                            <field name="version" readonly="1"/>
                            <field name="create_date"/>
                            <field name="email" widget="email"/>
                            <field name="test_entry" groups="base.group_no_one"/>
                        </group>
                    </group>
                </xpath>
            </field>
        </record>

        <record id="view_survey_user_input_tree_inherit" model="ir.ui.view">
            <field name="name">survey.user_input.inherit.tree</field>
            <field name="model">survey.user_input</field>
            <field name="inherit_id" ref="survey.survey_user_input_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="replace">
                    <field name="state" widget="badge"
                        decoration-warning="state == 'done'"
                        decoration-success="state == 'review'"
                        decoration-info="state == 'new'"
                        decoration-danger="state == 'in_progress'"/>
                </xpath>
            </field>
        </record>

        <record id="survey_question_answer_view_tree_inherit" model="ir.ui.view">
            <field name="name">survey.question.answer.view.tree</field>
            <field name="model">survey.question.answer</field>
            <field name="inherit_id" ref="survey.survey_question_answer_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//tree" position="attributes">
                    <attribute name="limit">200</attribute>
                </xpath>
            </field>
        </record>

    </data>
</odoo>